<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mijn Film & Serie Kijklijst</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            background-color: #111827; /* gray-900 */
            color: #e5e7eb; /* gray-200 */
            font-family: sans-serif;
        }
        .lucide-icon {
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
            stroke-width: 2;
        }
    </style>
</head>
<body class="bg-gray-900">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-white tracking-tight">
                Mijn Kijklijst
            </h1>
            <p class="text-gray-400 mt-2 text-lg">Zoek, bewaar en beoordeel je favoriete films en series.</p>
        </header>

        <main>
            <section id="search-section" class="max-w-2xl mx-auto mb-10">
                <div class="flex gap-2 p-2 bg-gray-800 rounded-lg shadow-lg">
                    <input type="text" id="search-input" placeholder="Zoek een film of serie..." class="flex-grow bg-gray-700 text-white placeholder-gray-400 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="search-button" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-md flex items-center justify-center">
                        <i data-lucide="search" class="lucide-icon"></i>
                    </button>
                </div>
            </section>

            <section id="search-results" class="mb-12">
                <h2 class="text-2xl font-bold text-white mb-4 border-b-2 border-gray-700 pb-2 hidden" id="results-title">Resultaten</h2>
                <div id="search-results-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    </div>
            </section>

            <section id="my-lists" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold text-white mb-4">Nog te Kijken</h2>
                    <div id="to-watch-list-container" class="space-y-4">
                        </div>
                </div>

                <div class="bg-gray-800 p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold text-white mb-4">Gezien</h2>
                    <div id="watched-list-container" class="space-y-4">
                        </div>
                </div>
            </section>
        </main>
        
        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p>Data aangeleverd door <a href="https://www.themoviedb.org/" target="_blank" class="text-blue-400 hover:underline">TMDb</a>.</p>
        </footer>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURATIE ---
            // BELANGRIJK: Vervang dit met je eigen TMDb API sleutel
            const apiKey = 'PLAK_HIER_JOUW_TMDB_API_SLEUTEL';
            const apiUrlBase = 'https://api.themoviedb.org/3';
            const imageUrlBase = 'https://image.tmdb.org/t/p/w500';

            // --- STATE ---
            let state = {
                toWatchList: [],
                watchedList: [],
            };

            // --- LOCALSTORAGE FUNCTIES ---
            const saveState = () => {
                localStorage.setItem('movieWatchlistState', JSON.stringify(state));
            };

            const loadState = () => {
                const savedStateJSON = localStorage.getItem('movieWatchlistState');
                if (savedStateJSON) {
                    state = JSON.parse(savedStateJSON);
                } else {
                    // Voorbeelddata als de gebruiker nieuw is
                    state = {
                        toWatchList: [{ id: 550, title: 'Fight Club', poster_path: '/pB8BM7pdSp6B6Ih7QZ4DrQ3PmJK.jpg', release_date: '1999-10-15' }],
                        watchedList: [{ id: 680, title: 'Pulp Fiction', poster_path: '/d5iIlFn5s0ImszYzBPb8JPIfbXD.jpg', release_date: '1994-09-10', rating: 5 }]
                    };
                }
            };

            // --- DOM ELEMENTEN ---
            const searchInput = document.getElementById('search-input');
            const searchButton = document.getElementById('search-button');
            const searchResultsContainer = document.getElementById('search-results-container');
            const resultsTitle = document.getElementById('results-title');
            const toWatchListContainer = document.getElementById('to-watch-list-container');
            const watchedListContainer = document.getElementById('watched-list-container');

            // --- API FUNCTIES ---
            const searchApi = async (query) => {
                if (!query) return;
                if (apiKey === 'PLAK_HIER_JOUW_TMDB_API_SLEUTEL') {
                    alert('Voeg eerst je TMDb API sleutel toe aan de code!');
                    return;
                }
                const url = `${apiUrlBase}/search/movie?api_key=${apiKey}&query=${encodeURIComponent(query)}&language=nl-NL&include_adult=false`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    renderSearchResults(data.results);
                } catch (error) {
                    console.error("Fout bij het ophalen van zoekresultaten:", error);
                    searchResultsContainer.innerHTML = `<p class="text-red-400">Kon de zoekresultaten niet laden. Controleer je API-sleutel en internetverbinding.</p>`;
                }
            };

            // --- RENDER FUNCTIES ---
            const renderSearchResults = (results) => {
                searchResultsContainer.innerHTML = '';
                if (results.length > 0) {
                    resultsTitle.classList.remove('hidden');
                } else {
                    resultsTitle.classList.add('hidden');
                    searchResultsContainer.innerHTML = `<p class="text-gray-400">Geen resultaten gevonden.</p>`;
                    return;
                }

                results.forEach(movie => {
                    const movieCard = `
                        <div class="bg-gray-800 rounded-lg overflow-hidden shadow-lg flex flex-col">
                            <img src="${movie.poster_path ? imageUrlBase + movie.poster_path : 'https://via.placeholder.com/500x750?text=Geen+Poster'}" alt="Poster van ${movie.title}" class="w-full h-auto object-cover">
                            <div class="p-4 flex flex-col flex-grow">
                                <h3 class="font-bold text-white text-lg">${movie.title}</h3>
                                <p class="text-gray-400 text-sm mb-4">${movie.release_date ? movie.release_date.split('-')[0] : 'Onbekend'}</p>
                                <div class="mt-auto">
                                    <button data-movie-id="${movie.id}" data-action="add-to-watch" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition-colors">
                                        Toevoegen
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    searchResultsContainer.innerHTML += movieCard;
                });
            };

            const renderLists = () => {
                saveState();
                toWatchListContainer.innerHTML = '';
                watchedListContainer.innerHTML = '';

                if(state.toWatchList.length === 0) toWatchListContainer.innerHTML = `<p class="text-gray-500">Je 'nog te kijken'-lijst is leeg.</p>`;
                if(state.watchedList.length === 0) watchedListContainer.innerHTML = `<p class="text-gray-500">Je hebt nog niets als 'gezien' gemarkeerd.</p>`;

                state.toWatchList.forEach(movie => {
                    toWatchListContainer.innerHTML += createListCard(movie, 'toWatch');
                });
                state.watchedList.forEach(movie => {
                    watchedListContainer.innerHTML += createListCard(movie, 'watched');
                });
                
                lucide.createIcons();
            };

            const createListCard = (movie, listType) => {
                const year = movie.release_date ? movie.release_date.split('-')[0] : 'Onbekend';
                const buttons = listType === 'toWatch' ? `
                    <button data-movie-id="${movie.id}" data-action="move-to-watched" class="p-2 text-green-400 hover:text-green-300" title="Markeer als gezien">
                        <i data-lucide="check-circle" class="lucide-icon"></i>
                    </button>
                ` : `
                    <div class="flex items-center text-yellow-400" title="Jouw score">
                        <i data-lucide="star" class="lucide-icon fill-current"></i>
                        <span class="ml-1 font-bold">${movie.rating || '?'}</span>
                    </div>
                `;

                return `
                    <div class="bg-gray-700 p-3 rounded-md flex items-center gap-4">
                        <img src="${movie.poster_path ? imageUrlBase + movie.poster_path : 'https://via.placeholder.com/50x75?text=N/A'}" class="w-12 h-auto rounded-sm">
                        <div class="flex-grow">
                            <h4 class="font-semibold text-white">${movie.title}</h4>
                            <p class="text-sm text-gray-400">${year}</p>
                        </div>
                        <div class="flex items-center gap-2">
                            ${buttons}
                            <button data-movie-id="${movie.id}" data-action="delete" data-list-type="${listType}" class="p-2 text-red-400 hover:text-red-300" title="Verwijderen">
                                <i data-lucide="trash-2" class="lucide-icon"></i>
                            </button>
                        </div>
                    </div>
                `;
            };

            // --- EVENT LISTENERS ---
            searchButton.addEventListener('click', () => searchApi(searchInput.value));
            searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    searchApi(searchInput.value);
                }
            });

            searchResultsContainer.addEventListener('click', async (e) => {
                const button = e.target.closest('button[data-action="add-to-watch"]');
                if (!button) return;

                const movieId = parseInt(button.dataset.movieId);
                if (state.toWatchList.some(m => m.id === movieId) || state.watchedList.some(m => m.id === movieId)) {
                    alert('Deze film staat al op een van je lijsten.');
                    return;
                }

                // Haal volledige filmdetails op om op te slaan
                const url = `${apiUrlBase}/movie/${movieId}?api_key=${apiKey}&language=nl-NL`;
                try {
                    const response = await fetch(url);
                    const movieData = await response.json();
                    state.toWatchList.unshift(movieData); // Voeg vooraan toe
                    renderLists();
                    // Wis zoekresultaten voor een schone interface
                    searchResultsContainer.innerHTML = '';
                    resultsTitle.classList.add('hidden');
                    searchInput.value = '';
                } catch(error) {
                    console.error("Kon filmdetails niet ophalen:", error);
                    alert("Er ging iets mis met het toevoegen van de film.");
                }
            });

            document.getElementById('my-lists').addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;
                
                const action = button.dataset.action;
                const movieId = parseInt(button.dataset.movieId);

                if (action === 'delete') {
                    const listType = button.dataset.listType;
                    state[listType + 'List'] = state[listType + 'List'].filter(m => m.id !== movieId);
                }
                
                if (action === 'move-to-watched') {
                    const movieIndex = state.toWatchList.findIndex(m => m.id === movieId);
                    if (movieIndex > -1) {
                        const movie = state.toWatchList.splice(movieIndex, 1)[0];
                        
                        // Vraag om een beoordeling
                        const rating = prompt(`Welke score (1-5) geef je ${movie.title}?`, '5');
                        movie.rating = parseInt(rating) || 5; // Standaard een 5 als input ongeldig is
                        
                        state.watchedList.unshift(movie);
                    }
                }

                renderLists();
            });

            // --- INITIALISATIE ---
            loadState();
            renderLists();
            lucide.createIcons();
        });
    </script>
</body>
</html>
